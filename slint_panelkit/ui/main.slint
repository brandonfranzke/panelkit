// PanelKit UI - Using Slint's layout engine
import { Button, ScrollView, StandardButton } from "std-widgets.slint";

// Main window
export component MainWindow inherits Window {
    callback set-background-color(color);
    callback change-page(int);
    callback cycle-color();
    callback quit-app();
    
    preferred-width: 480px;
    preferred-height: 640px;
    
    in-out property <int> current-page: 0;
    in-out property <bool> is-portrait: self.height > self.width;
    in-out property <color> my-background: #222222;
    
    // All our color definitions
    property <color> color-red: #ff0000;
    property <color> color-green: #00ff00;
    property <color> color-blue: #0000ff;
    property <color> color-purple: #800080;
    property <color> color-time: #006699;
    property <color> color-random: #555555;
    property <color> color-back: #444444;
    property <color> color-quit: #aa3333;
    
    // Layout calculations
    property <length> smaller-dim: min(self.width, self.height);
    property <length> my-padding: smaller-dim * 0.05;
    property <length> my-spacing: smaller-dim * 0.03;
    property <length> button-size: (smaller-dim - (2 * my-padding) - my-spacing) / 2;
    
    Rectangle {
        width: parent.width;
        height: parent.height;
        background: root.my-background;
        
        // Page 1: Introduction
        if root.current-page == 0: Rectangle {
            VerticalLayout {
                padding: 20px;
                spacing: 20px;
                alignment: center;
                
                Text {
                    text: "Minimal Slint Demo";
                    font-size: 24px;
                    color: white;
                    horizontal-alignment: center;
                }
                
                Rectangle {
                    width: 200px;
                    height: 60px;
                    border-radius: 10px;
                    background: #6fa8dc;
                    
                    Text {
                        text: "Touch Here";
                        color: white;
                        font-size: 16px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                    
                    TouchArea {
                        clicked => {
                            info-text.visible = !info-text.visible;
                            debug("Touch button clicked - toggling info text");
                        }
                    }
                }
                
                info-text := Text {
                    text: "Swipe left to see more";
                    color: #93c47d;
                    font-size: 18px;
                    horizontal-alignment: center;
                    visible: true;
                }
            }
        }
        
        // Page 2: Button grid
        if root.current-page == 1: ScrollView {
            if root.is-portrait: VerticalLayout {
                // Portrait: 2x4 grid
                padding: root.my-padding;
                spacing: root.my-spacing;
                
                HorizontalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-red;
                        
                        Text {
                            text: "Red";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-red;
                                root.set-background-color(root.color-red);
                                debug("Red button clicked");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-green;
                        
                        Text {
                            text: "Green";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-green;
                                root.set-background-color(root.color-green);
                                debug("Green button clicked");
                            }
                        }
                    }
                }
                
                HorizontalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-blue;
                        
                        Text {
                            text: "Blue";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-blue;
                                root.set-background-color(root.color-blue);
                                debug("Blue button clicked");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-purple;
                        
                        Text {
                            text: "Purple";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-purple;
                                root.set-background-color(root.color-purple);
                                debug("Purple button clicked");
                            }
                        }
                    }
                }
                
                HorizontalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-time;
                        
                        Text {
                            text: "Time";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                debug("Time button clicked - TODO: show actual time");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-random;
                        
                        Text {
                            text: "Random";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.cycle-color();
                                debug("Random button clicked - cycling color");
                            }
                        }
                    }
                }
                
                HorizontalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-back;
                        
                        Text {
                            text: "Back";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.current-page = 0;
                                root.change-page(0);
                                debug("Back button clicked");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-quit;
                        
                        Text {
                            text: "Quit";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-red;
                                root.quit-app();
                                debug("Quit button clicked");
                            }
                        }
                    }
                }
            }
            
            if !root.is-portrait: HorizontalLayout {
                // Landscape: 4x2 grid
                padding: root.my-padding;
                spacing: root.my-spacing;
                
                VerticalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-red;
                        
                        Text {
                            text: "Red";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-red;
                                root.set-background-color(root.color-red);
                                debug("Red button clicked");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-time;
                        
                        Text {
                            text: "Time";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                debug("Time button clicked - TODO: show actual time");
                            }
                        }
                    }
                }
                
                VerticalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-green;
                        
                        Text {
                            text: "Green";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-green;
                                root.set-background-color(root.color-green);
                                debug("Green button clicked");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-random;
                        
                        Text {
                            text: "Random";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.cycle-color();
                                debug("Random button clicked - cycling color");
                            }
                        }
                    }
                }
                
                VerticalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-blue;
                        
                        Text {
                            text: "Blue";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-blue;
                                root.set-background-color(root.color-blue);
                                debug("Blue button clicked");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-back;
                        
                        Text {
                            text: "Back";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.current-page = 0;
                                root.change-page(0);
                                debug("Back button clicked");
                            }
                        }
                    }
                }
                
                VerticalLayout {
                    spacing: root.my-spacing;
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-purple;
                        
                        Text {
                            text: "Purple";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-purple;
                                root.set-background-color(root.color-purple);
                                debug("Purple button clicked");
                            }
                        }
                    }
                    
                    Rectangle {
                        width: root.button-size;
                        height: root.button-size;
                        border-radius: 10px;
                        background: root.color-quit;
                        
                        Text {
                            text: "Quit";
                            color: white;
                            font-size: root.button-size * 0.15;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                root.my-background = root.color-red;
                                root.quit-app();
                                debug("Quit button clicked");
                            }
                        }
                    }
                }
            }
        }
        
        // Touch area for swipe detection
        TouchArea {
            property <length> start-x;
            
            width: parent.width;
            height: parent.height;
            
            pointer-event(event) => {
                if (event.kind == PointerEventKind.down) {
                    self.start-x = self.mouse-x;
                    debug("Touch down at", self.start-x, "- Current page:", root.current-page);
                } else if (event.kind == PointerEventKind.up) {
                    debug("Touch up at", self.mouse-x, "- Start was", self.start-x);
                    debug("Current page:", root.current-page);
                    
                    // Swipe left (to go to next page)
                    if (self.mouse-x - self.start-x) < -100px && root.current-page == 0 {
                        root.current-page = 1;
                        root.change-page(1);
                        debug("Swipe left detected - changing to page 1");
                    }
                    // Swipe right (to go to previous page)
                    else if (self.mouse-x - self.start-x) > 100px && root.current-page == 1 {
                        root.current-page = 0;
                        root.change-page(0);
                        debug("Swipe right detected - changing to page 0");
                    }
                }
            }
        }
    }
}